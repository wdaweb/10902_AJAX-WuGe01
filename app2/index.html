<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>學生資料管理系統</title>
    <link rel="shortcut icon" href="#" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <!---匯入要使用的函式庫--->
    <script src="./api/jquery-3.5.1.js"></script>


</head>
<body>
  <h1>學生資料管理系統</h1>
  <input type="button" value="新增學生資料" onclick="opCreate()">


  <div class="query">
    班級:<select name="classes" id="classes" onchange="getstudents(this.value)"></select>
    <input type="text"  id="query">
    <input type="button" value="查詢" onclick="query()">
    <div class="query-result"></div>
    <div class="query1"></div>
  </div>

  <div id="noBlock" style="display: none;">
    <form action="api/insert.php" method="POST" id="create"> 
      <ul>
        <li>學號:<input type="text" name="uni_id" id="uni_id"></li>
        <li>班級座號:<select name="class_num" id="class_num"></select></li>
        <li>姓名:<input type="text" name="name" id="name"></li>
        <li>出生年月日:<input type="text" name="birthday" id="birthday"></li>
        <li>身份證字號:<input type="text" name="nat_id" id="nat_id"></li>
        <li>住址:<input type="text" name="addr" id="addr"></li>
        <li>父母:<input type="text" name="parent" id="parent"></li>
        <li>電話:<input type="text" name="tel" id="tel"></li>
        <li>科別:<input type="text" name="dept" id="dept"></li>
        <li>畢業國中:<input type="text" name="grad_at" id="grad_at"></li>
      </ul>
      <input type="button" value="確認新增" onclick="create()">
    </form>
  </div>

</body>
</html>
<script>
/************************************
* 1.考慮觸發行為的事件
* 2.建立監聽行為
* 3.考慮是否需要代入參數
* 4.是否會有回傳值？回傳值的功用及處理？
* 5.是否需要更新畫面內容？更新畫面的方法？
************************************/
getClass()
function getClass() {
  $.get('./api/select_class.php',(e)=>{
    document.querySelector('#classes').innerHTML=e
    document.querySelector('#class_num').innerHTML=e
  })
  
}
function getstudents(e) {
  console.log(e);
  $.get('api/getstudents.php',{'class':e},(k)=>{
    console.log(k);
    document.querySelector('.query1').innerHTML=k;
  })
}


function opCreate() {
  if(document.querySelector('#noBlock').style.display == "block"){
    document.querySelector('#noBlock').style.display="none";
  }else{
    document.querySelector('#noBlock').style.display="block";
  }
}

//新增資料的函式
function create(){
  let uni_id=document.querySelector('#uni_id').value
  let class_num=document.querySelector('#class_num').value
  let name=document.querySelector('#name').value
  let birthday=document.querySelector('#birthday').value
  let nat_id=document.querySelector('#nat_id').value
  let addr=document.querySelector('#addr').value
  let parent=document.querySelector('#parent').value
  let tel=document.querySelector('#tel').value
  let dept=document.querySelector('#dept').value
  let grad_at=document.querySelector('#grad_at').value
  console.log(uni_id,class_num,name,birthday,nat_id,addr,parent,tel,dept,grad_at) 
  $.post("api/insert.php",{uni_id,class_num,name,birthday,nat_id,addr,parent,tel,dept,grad_at},(a)=>{
    console.log(a)
    if(a=='1'){
      alert("新增成功")
      document.querySelector('#noBlock').style.display="none"
      getClass()
    }else{
      alert("新增失敗")
    }
  })
}

//查詢資料的函式
function query(){
  let str=document.querySelector("#query").value
  $.get("./api/query.php",{'str':str},(e)=>{
   console.log(e);
   document.querySelector('.query-result').innerHTML=e;
  })
}

//編輯資料的函式
function update(){

}

//刪除資料的函式
function del(){

}

</script>